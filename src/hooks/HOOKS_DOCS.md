# توثيق مجلد الخطافات (Hooks Documentation)

**المسار:** `src/hooks/`
**الغرض العام:** يحتوي هذا المجلد على Custom Hooks الخاصة بـ React والتي تُعيد استخدام المنطق (Logic) عبر مكونات التطبيق المختلفة، مثل التعامل مع استجابة الشاشة (Responsive Design) وإدارة الإشعارات (Toasts).

---

## 1. ملف `src/hooks/index.ts`
**الوصف:** ملف تجميعي (Barrel file) يهدف إلى تسهيل استيراد الـ Hooks من مسار واحد نظيف.
*   يقوم بتصدير `useIsMobile` من ملف `use-mobile`.
*   يقوم بتصدير `useToast` و `toast` من ملف `use-toast`.

---

## 2. ملف `src/hooks/use-mobile.tsx`
**الوصف:** يوفر Hook لتحديد ما إذا كان المستخدم يتصفح التطبيق من جهاز محمول (شاشة صغيرة) بناءً على عرض النافذة.

### الثوابت:
*   `MOBILE_BREAKPOINT`: قيمة ثابتة (`768`) تمثل الحد الفاصل (بالبكسل) الذي يعتبر العرض أقل منه "جهازاً محمولاً".

### الدالة `useIsMobile()`
*   **الغرض:** تراقب عرض نافذة المتصفح وتُرجع قيمة منطقية (`boolean`) تشير إلى حالة الجهاز.
*   **آلية العمل:**
    1.  تستخدم `React.useState` لتخزين حالة `isMobile` (هل هو موبايل أم لا).
    2.  تستخدم `React.useEffect` لإضافة مستمع لحدث تغيير حجم الشاشة (Media Query Listener) باستخدام `window.matchMedia`.
    3.  يتم تحديث الحالة `isMobile` كلما تغير حجم النافذة وتجاوز أو نزل عن نقطة الفصل (`MOBILE_BREAKPOINT`).
    4.  تقوم بتنظيف المستمع (removeEventListener) عند إلغاء تحميل المكون.
*   **القيمة المرجعة:** `true` إذا كان عرض الشاشة أقل من 768 بكسل، و `false` خلاف ذلك.

---

## 3. ملف `src/hooks/use-toast.ts`
**الوصف:** نظام متكامل لإدارة وعرض الإشعارات المنبثقة (Toasts) في التطبيق. مستوحى من مكتبة `react-hot-toast` ولكنه مبني داخلياً. يستخدم نمط Pub/Sub (Publisher/Subscriber) لإدارة الحالة خارج دورة حياة React العادية، مما يسمح بإطلاق الإشعارات من أي مكان (حتى خارج المكونات).

### الثوابت والمتغيرات العامة:
*   `TOAST_LIMIT`: الحد الأقصى لعدد الإشعارات المعروضة في نفس الوقت (مضبوط على 1).
*   `TOAST_REMOVE_DELAY`: الوقت بالمللي ثانية قبل إزالة الإشعار نهائياً من الذاكرة بعد إخفائه (`1000000` - وقت طويل جداً، يبدو أنه يعتمد على الإخفاء اليدوي أو التلقائي عبر `dismiss`).
*   `toastTimeouts`: خريطة (Map) لتتبع مؤقتات الإزالة لكل إشعار لمنع التضارب.
*   `memoryState`: كائن يحفظ حالة الإشعارات الحالية في الذاكرة (Global State).
*   `listeners`: مصفوفة من الدوال التي تستمع للتغييرات في `memoryState` (لتحديث مكونات React).

### الدوال المساعدة:
*   `genId()`: تولد معرفاً فريداً لكل إشعار (مجرد عداد تزايدي).
*   `addToRemoveQueue(toastId)`: تضيف إشعاراً لقائمة الإزالة المؤجلة. تستخدم `setTimeout` لإطلاق إجراء `REMOVE_TOAST` بعد فترة التأخير.
*   `dispatch(action)`: دالة التوزيع المركزية. تقوم بتحديث `memoryState` باستخدام الـ `reducer` ثم تستدعي جميع الـ `listeners` لإعلام المكونات بالتحديث.

### دالة `reducer(state, action)`
*   **الغرض:** دالة نقية (Pure Function) تدير منطق تحديث حالة الإشعارات بناءً على نوع الإجراء (`Action Type`).
*   **الإجراءات المدعومة:**
    *   `ADD_TOAST`: تضيف إشعاراً جديداً للمقدمة، مع مراعاة `TOAST_LIMIT`.
    *   `UPDATE_TOAST`: تحديث بيانات إشعار موجود (مثل تغيير النص).
    *   `DISMISS_TOAST`: إغلاق الإشعار (تغيير `open` إلى `false`) وإضافته لقائمة الإزالة.
    *   `REMOVE_TOAST`: حذف الإشعار نهائياً من المصفوفة.

### الدالة `toast(props)`
*   **الغرض:** دالة يمكن استدعاؤها من أي مكان لإظهار إشعار جديد.
*   **آلية العمل:**
    1.  تولد ID جديد.
    2.  ترسل إجراء `ADD_TOAST` عبر `dispatch`.
    3.  تعين دالة `onOpenChange` لإغلاق الإشعار تلقائياً عند تغيير حالته.
*   **القيمة المرجعة:** كائن يحتوي على:
    *   `id`: معرف الإشعار.
    *   `dismiss()`: دالة لإغلاق هذا الإشعار تحديداً.
    *   `update(props)`: دالة لتحديث محتوى هذا الإشعار.

### الخطاف `useToast()`
*   **الغرض:** Hook يُستخدم داخل مكونات React للوصول إلى حالة الإشعارات ووظائف التحكم بها.
*   **آلية العمل:**
    1.  يستخدم `useState` لعمل نسخة محلية من `memoryState`.
    2.  يستخدم `useEffect` لتسجيل دالة `setState` الخاصة به ضمن قائمة `listeners` العالمية، مما يضمن إعادة تصيير المكون عند تحديث الإشعارات.
    3.  يزيل المستمع عند إلغاء تحميل المكون.
*   **القيمة المرجعة:**
    *   `toasts`: قائمة الإشعارات الحالية.
    *   `toast`: الدالة العالمية لإضافة إشعار (نفس `toast` المذكورة أعلاه).
    *   `dismiss(toastId?)`: دالة لإغلاق إشعار معين أو كل الإشعارات.
