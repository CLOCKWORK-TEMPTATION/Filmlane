# ุชูุซูู ูููุงุช ุงูุฃุฏูุงุช ุงููุณุงุนุฏุฉ (Utilities)
## ุงููุณุงุฑ: `src/utils/`

---

## ๐ ุฌุฏูู ุงููุญุชููุงุช

1. [cn.ts](#cnts) - ุฏูุฌ ุฃุณูุงุก ุงูููุงุณุงุช
2. [context-memory-manager.ts](#context-memory-managerts) - ูุฏูุฑ ุฐุงูุฑุฉ ุงูุณูุงู
3. [editor-styles.ts](#editor-stylests) - ุฃููุงุท ุงููุญุฑุฑ
4. [index.ts](#indexts) - ููู ุงูุชุตุฏูุฑ ุงูุฑุฆูุณู
5. [logger.ts](#logerts) - ูุธุงู ุงูุชุณุฌูู
6. [paste-classifier.ts](#paste-classifierts) - ูุนุงูุฌ ุงููุตู ูุงูุชุตููู

---

## 1. cn.ts

**ุงููุตู:** ุฏุงูุฉ ูุณุงุนุฏุฉ ูุฏูุฌ ุฃุณูุงุก ููุงุณุงุช CSS ู Tailwind ุจุดูู ุฐูู.

### ุงูุดููุฑุฉ ุงููุตุฏุฑูุฉ:
```typescript
import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}
```

### ุดุฑุญ ุณุทุฑ ุจุณุทุฑ:

| ุงูุณุทุฑ | ุงูุดููุฑุฉ | ุงููุตู |
|-------|---------|-------|
| 1 | `import { clsx, type ClassValue } from "clsx"` | ุงุณุชูุฑุงุฏ ุฏุงูุฉ `clsx` ูููุน `ClassValue` ูู ููุชุจุฉ clsx ุงูุชู ุชูุณุชุฎุฏู ูุฏูุฌ ุฃุณูุงุก ุงูููุงุณุงุช ุจุดูู ุดุฑุทู |
| 2 | `import { twMerge } from "tailwind-merge"` | ุงุณุชูุฑุงุฏ ุฏุงูุฉ `twMerge` ูู ููุชุจุฉ tailwind-merge ุงูุชู ุชูุณุชุฎุฏู ูุญู ุงูุชุนุงุฑุถุงุช ุจูู ููุงุณุงุช Tailwind |
| 4 | `export function cn(...inputs: ClassValue[]) {` | ุชุตุฏูุฑ ุงูุฏุงูุฉ `cn` ุงูุชู ุชุณุชูุจู ุนุฏุฏ ุบูุฑ ูุญุฏูุฏ ูู ุงููุฏุฎูุงุช ูู ููุน `ClassValue` |
| 5 | `return twMerge(clsx(inputs))` | ุฅุฑุฌุงุน ุงููุชูุฌุฉ ุจุนุฏ ุชุทุจูู `clsx` ุฃููุงู ูุฏูุฌ ุงูููุงุณุงุชุ ุซู `twMerge` ูุฅุฒุงูุฉ ุงูุชุนุงุฑุถุงุช |

### ุงูุงุณุชุฎุฏุงู:
```typescript
// ูุซุงู: ุฏูุฌ ููุงุณุงุช ุจุดูู ุดุฑุทู
cn("px-4 py-2", isActive && "bg-blue-500", "text-white")
```

---

## 2. context-memory-manager.ts

**ุงููุตู:** ูุฏูุฑ ุฐุงูุฑุฉ ุงูุณูุงู - ููุณุชุฎุฏู ูุชุฎุฒูู ูุงุณุชุฑุฌุงุน ุชุญูููุงุช ุงูุณููุงุฑูู ูุงูุดุฎุตูุงุช ุงููุชูุฑุฑุฉ.

### ุดุฑุญ ุณุทุฑ ุจุณุทุฑ:

| ุงูุณุทุฑ | ุงูุดููุฑุฉ | ุงููุตู |
|-------|---------|-------|
| 1 | `import { logger } from './logger';` | ุงุณุชูุฑุงุฏ ูุธุงู ุงูุชุณุฌูู ูุชุชุจุน ุงูุนูููุงุช |
| 2 | `import type { ClassificationRecord, ContextMemory } from '@/types/screenplay';` | ุงุณุชูุฑุงุฏ ุงูุฃููุงุน ุงูุฎุงุตุฉ ุจุชุตููู ุงูุณูุงู |
| 4 | `export type { ClassificationRecord, ContextMemory };` | ุฅุนุงุฏุฉ ุชุตุฏูุฑ ุงูุฃููุงุน ููุงุณุชุฎุฏุงู ุงูุฎุงุฑุฌู |
| 10 | `export class ContextMemoryManager {` | ุชุนุฑูู ุตูู (Class) ุฑุฆูุณู ูุฅุฏุงุฑุฉ ุฐุงูุฑุฉ ุงูุณูุงู |
| 11 | `private storage: Map<string, ContextMemory> = new Map();` | ุฎุงุตูุฉ ุฎุงุตุฉ ูุชุฎุฒูู ุงูุจูุงูุงุช ูู ุงูุฐุงูุฑุฉ ุจุงุณุชุฎุฏุงู Map |
| 13 | `constructor() {` | ุจุงูู ุงูุตูู - ููููุฐ ุนูุฏ ุฅูุดุงุกๅฎไพ ุฌุฏูุฏุฉ |
| 14 | `logger.info('MemoryManager', 'ContextMemoryManager initialized (in-memory).');` | ุชุณุฌูู ุฑุณุงูุฉ ุนูุฏ ุชููุฆุฉ ุงููุฏูุฑ |
| 17 | `async loadContext(sessionId: string): Promise<ContextMemory \| null> {` | ุฏุงูุฉ ุบูุฑ ูุชุฒุงููุฉ ูุชุญููู ุณูุงู ุฌูุณุฉ ูุนููุฉ |
| 18 | `if (this.storage.has(sessionId)) {` | ุงูุชุญูู ูู ูุฌูุฏ ุงูุฌูุณุฉ ูู ุงูุชุฎุฒูู |
| 19 | `logger.info('MemoryManager', \`Loading context for session: ${sessionId}\`);` | ุชุณุฌูู ุนูููุฉ ุงูุชุญููู |
| 20 | `return JSON.parse(JSON.stringify(this.storage.get(sessionId)!));` | ุฅุฑุฌุงุน ูุณุฎุฉ ุนูููุฉ (deep copy) ูู ุงูุจูุงูุงุช |
| 22 | `logger.warning('MemoryManager', \`No context found for session: ${sessionId}\`);` | ุชุณุฌูู ุชุญุฐูุฑ ุฅุฐุง ูู ูุชู ุงูุนุซูุฑ ุนูู ุงูุฌูุณุฉ |
| 26 | `async saveContext(sessionId: string, memory: ContextMemory): Promise<void> {` | ุฏุงูุฉ ุบูุฑ ูุชุฒุงููุฉ ูุญูุธ ุณูุงู ุงูุฌูุณุฉ |
| 28 | `this.storage.set(sessionId, JSON.parse(JSON.stringify(memory)));` | ุชุฎุฒูู ูุณุฎุฉ ุนูููุฉ ูู ุงูุจูุงูุงุช |
| 31 | `async updateMemory(sessionId: string, classifications: ClassificationRecord[]): Promise<void> {` | ุฏุงูุฉ ูุชุญุฏูุซ ุงูุฐุงูุฑุฉ ุจุชุตูููุงุช ุฌุฏูุฏุฉ |
| 34 | `const memory = (await this.loadContext(sessionId)) \|\| { ... };` | ุชุญููู ุงูุฐุงูุฑุฉ ุงูุญุงููุฉ ุฃู ุฅูุดุงุก ุฌุฏูุฏุฉ |
| 45 | `memory.lastModified = Date.now();` | ุชุญุฏูุซ ููุช ุขุฎุฑ ุชุนุฏูู |
| 46-49 | `memory.data.lastClassifications = ...` | ุชุญุฏูุซ ุขุฎุฑ 20 ุชุตููู ูุน ุงูุญูุงุธ ุนูู ุงููุฏููุฉ |
| 51-62 | `classifications.forEach((record) => { ... });` | ุชูุฑุงุฑ ุนูู ุงูุชุตูููุงุช ูุงุณุชุฎุฑุงุฌ ุงูุดุฎุตูุงุช |
| 52 | `if (record.classification === 'character') {` | ุงูุชุญูู ูู ุฃู ุงูุชุตููู ุดุฎุตูุฉ |
| 53 | `const charName = record.line.replace(/[:๏ผ]/g, '').trim();` | ุชูุธูู ุงุณู ุงูุดุฎุตูุฉ ูู ุงูููุทุชูู |
| 55-57 | `if (!memory.data.commonCharacters.includes(charName)) { ... }` | ุฅุถุงูุฉ ุงูุดุฎุตูุฉ ุฅุฐุง ูู ุชูู ููุฌูุฏุฉ |
| 58-59 | `memory.data.characterDialogueMap[charName] = ...` | ุฒูุงุฏุฉ ุนุฏุงุฏ ุญูุงุฑุงุช ุงูุดุฎุตูุฉ |
| 64 | `await this.saveContext(sessionId, memory);` | ุญูุธ ุงูุฐุงูุฑุฉ ุงููุญุฏุซุฉ |

### ูููู ุงูุจูุงูุงุช:
```typescript
interface ContextMemory {
  sessionId: string;
  lastModified: number;
  data: {
    commonCharacters: string[];      // ุงูุดุฎุตูุงุช ุงููุชูุฑุฑุฉ
    commonLocations: string[];        // ุงูููุงูุน ุงููุชูุฑุฑุฉ
    lastClassifications: string[];    // ุขุฎุฑ ุงูุชุตูููุงุช
    characterDialogueMap: Record<string, number>; // ุนุฏุงุฏ ุญูุงุฑุงุช ูู ุดุฎุตูุฉ
  };
}
```

---

## 3. editor-styles.ts

**ุงููุตู:** ุชุนุฑูู ุฃููุงุท CSS ููู ููุน ูู ุฃููุงุน ุชูุณูู ุงูุณููุงุฑูู.

### ุดุฑุญ ุณุทุฑ ุจุณุทุฑ:

| ุงูุณุทุฑ | ุงูุดููุฑุฉ | ุงููุตู |
|-------|---------|-------|
| 1 | `import React from 'react';` | ุงุณุชูุฑุงุฏ React ููุญุตูู ุนูู ููุน CSSProperties |
| 10-14 | `export const getFormatStyles = (...)` | ุฏุงูุฉ ุชูุฑุฌุน ุฃููุงุท CSS ุญุณุจ ููุน ุงูุชูุณูู |
| 15-22 | `const baseStyles: React.CSSProperties = { ... }` | ุงูุฃููุงุท ุงูุฃุณุงุณูุฉ ุงููุดุชุฑูุฉ (ุงูุฎุทุ ุงูุงุชุฌุงูุ ุงุฑุชูุงุน ุงูุณุทุฑ) |
| 24-71 | `const formatStyles: { ... } = { ... }` | ูุงุฆู ูุญุชูู ุนูู ุฃููุงุท ุฎุงุตุฉ ููู ููุน |
| 25-32 | `basmala: { ... }` | ุชูุณูู ุงูุจุณููุฉ (ูุญุงุฐุงุฉ ูููุณุงุฑุ ุญุฌู ุฎุท 16pt) |
| 33-38 | `scene-header-top-line: { ... }` | ุชูุณูู ุงูุณุทุฑ ุงูุนููู ูุนููุงู ุงููุดูุฏ (flexbox) |
| 39-42 | `scene-header-1: { ... }` | ุชูุณูู ุฑูู ุงููุดูุฏ (ุนุฑูุถุ ุฃุญุฑู ูุจูุฑุฉ) |
| 43-45 | `scene-header-2: { ... }` | ุชูุณูู ูุตู ุงููุดูุฏ (flex ุซุงุจุช) |
| 46-48 | `scene-header-3: { ... }` | ุชูุณูู ุนููุงู ุงููุดูุฏ ุงูุฅุถุงูู (ูุญุงุฐุงุฉ ูุณุท) |
| 49-53 | `action: { ... }` | ุชูุณูู ุงูุญุฑูุฉ (ูุญุงุฐุงุฉ ููููููุ ุนุฑุถ 100%) |
| 54-57 | `character: { ... }` | ุชูุณูู ุงุณู ุงูุดุฎุตูุฉ (ูุญุงุฐุงุฉ ูุณุท) |
| 58-61 | `parenthetical: { ... }` | ุชูุณูู ุงูุชุนููู ุจูู ููุณูู (ูุญุงุฐุงุฉ ูุณุท) |
| 62-66 | `dialogue: { ... }` | ุชูุณูู ุงูุญูุงุฑ (ุนุฑุถ 2.5 ุจูุตุฉุ ูุญุงุฐุงุฉ ูุณุท) |
| 67-70 | `transition: { ... }` | ุชูุณูู ุงูุงูุชูุงู (ูุญุงุฐุงุฉ ูุณุท) |
| 73 | `const finalStyles = { ...baseStyles, ...formatStyles[formatType] };` | ุฏูุฌ ุงูุฃููุงุท ุงูุฃุณุงุณูุฉ ูุน ุงูุฎุงุตุฉ |
| 74 | `return finalStyles;` | ุฅุฑุฌุงุน ุงูุฃููุงุท ุงูููุงุฆูุฉ |

### ุฃููุงุน ุงูุชูุณููุงุช ุงููุฏุนููุฉ:
- `basmala` - ุงูุจุณููุฉ
- `scene-header-top-line` - ุงูุณุทุฑ ุงูุนููู ูุนููุงู ุงููุดูุฏ
- `scene-header-1` - ุฑูู ุงููุดูุฏ
- `scene-header-2` - ูุตู ุงููุดูุฏ (ุฏุงุฎูู/ุฎุงุฑุฌู)
- `scene-header-3` - ุนููุงู ุงููุดูุฏ ุงูุฅุถุงูู
- `action` - ูุตู ุงูุญุฑูุฉ
- `character` - ุงุณู ุงูุดุฎุตูุฉ
- `parenthetical` - ุชุนููู ุจูู ููุณูู
- `dialogue` - ุงูุญูุงุฑ
- `transition` - ุงูุงูุชูุงู

---

## 4. index.ts

**ุงููุตู:** ููู ุงูุชุตุฏูุฑ ุงูุฑุฆูุณู - ูุฌูุน ุฌููุน ุงูุชุตุฏูุฑุงุช ูู ูุฌูุฏ utils ูู ููุงู ูุงุญุฏ.

### ุดุฑุญ ุณุทุฑ ุจุณุทุฑ:

| ุงูุณุทุฑ | ุงูุดููุฑุฉ | ุงููุตู |
|-------|---------|-------|
| 1 | `export { cn } from './cn';` | ุฅุนุงุฏุฉ ุชุตุฏูุฑ ุฏุงูุฉ ุฏูุฌ ุงูููุงุณุงุช |
| 2 | `export { logger } from './logger';` | ุฅุนุงุฏุฉ ุชุตุฏูุฑ ูุธุงู ุงูุชุณุฌูู |
| 3 | `export { getFormatStyles } from './editor-styles';` | ุฅุนุงุฏุฉ ุชุตุฏูุฑ ุฏุงูุฉ ุงูุฃููุงุท |
| 4 | `export { handlePaste } from './paste-classifier';` | ุฅุนุงุฏุฉ ุชุตุฏูุฑ ูุนุงูุฌ ุงููุตู |
| 5 | `export { ContextMemoryManager } from './context-memory-manager';` | ุฅุนุงุฏุฉ ุชุตุฏูุฑ ูุฏูุฑ ุงูุฐุงูุฑุฉ |
| 6 | `export type { ClassificationRecord, ContextMemory } from './context-memory-manager';` | ุฅุนุงุฏุฉ ุชุตุฏูุฑ ุงูุฃููุงุน |

### ุงูุงุณุชุฎุฏุงู:
```typescript
// ุจุฏูุงู ูู:
import { cn } from './utils/cn';
import { logger } from './utils/logger';

// ูููู ุงุณุชุฎุฏุงู:
import { cn, logger } from './utils';
```

---

## 5. logger.ts

**ุงููุตู:** ูุธุงู ุชุณุฌูู ุจุณูุท ููุณุชููุงุช ูุฎุชููุฉ ูู ุงูุฑุณุงุฆู (info, warning, error).

### ุดุฑุญ ุณุทุฑ ุจุณุทุฑ:

| ุงูุณุทุฑ | ุงูุดููุฑุฉ | ุงููุตู |
|-------|---------|-------|
| 1-5 | `const LOG_LEVELS = { info: 1, warning: 2, error: 3, none: 4 };` | ุชุนุฑูู ูุณุชููุงุช ุงูุชุณุฌูู ุจุฃุฑูุงู ููููุงุฑูุฉ |
| 8 | `type LogLevel = keyof typeof LOG_LEVELS;` | ุชุนุฑูู ููุน ูุณุญุจ ููุงุชูุญ ูุงุฆู LOG_LEVELS |
| 10 | `const CURRENT_LOG_LEVEL: LogLevel = 'info';` | ุชุญุฏูุฏ ุงููุณุชูู ุงูุญุงูู ููุชุณุฌูู |
| 12 | `class Logger {` | ุชุนุฑูู ุตูู ุงููุณุฌู |
| 13 | `private log(level: LogLevel, component: string, message: string) {` | ุฏุงูุฉ ุฎุงุตุฉ ููุทุจุงุนุฉ ุงููุนููุฉ |
| 14 | `if (LOG_LEVELS[level] >= LOG_LEVELS[CURRENT_LOG_LEVEL]) {` | ุงูุชุญูู ูู ุฃู ูุณุชูู ุงูุฑุณุงูุฉ >= ุงููุณุชูู ุงูุญุงูู |
| 15 | `if (level === 'error') {` | ุฅุฐุง ูุงู ูุณุชูู ุงูุฎุทุฃ |
| 16 | `console.error(\`[${level.toUpperCase()}] [${component}] ${message}\`);` | ุทุจุงุนุฉ ุจุตูุบุฉ ุฎุทุฃ ุฃุญูุฑ |
| 17 | `else if (level === 'warning')` | ุฅุฐุง ูุงู ูุณุชูู ุชุญุฐูุฑ |
| 18 | `console.warn(...)` | ุทุจุงุนุฉ ุจุตูุบุฉ ุชุญุฐูุฑ ุฃุตูุฑ |
| 20 | `console.log(...)` | ุทุจุงุนุฉ ุนุงุฏูุฉ ูููุณุชูู info |
| 25 | `info(component: string, message: string) {` | ุฏุงูุฉ ุนุงูุฉ ูุชุณุฌูู ูุนูููุงุช |
| 30 | `warning(component: string, message: string) {` | ุฏุงูุฉ ุนุงูุฉ ูุชุณุฌูู ุชุญุฐูุฑุงุช |
| 34 | `error(component: string, message: string) {` | ุฏุงูุฉ ุนุงูุฉ ูุชุณุฌูู ุฃุฎุทุงุก |
| 38 | `export const logger = new Logger();` | ุชุตุฏูุฑ ูุซูู ูุงุญุฏ (singleton) ูู ุงููุณุฌู |

### ูุซุงู ุงูุงุณุชุฎุฏุงู:
```typescript
logger.info('Component', 'ุชู ุชุญููู ุงูุจูุงูุงุช');
logger.warning('API', 'ุงูุชูุช ููุช ุงูุทูุจ');
logger.error('Database', 'ูุดู ุงูุงุชุตุงู');
```

---

## 6. paste-classifier.ts

**ุงููุตู:** ุฃูุจุฑ ูุฃูู ููู - ููุนุงูุฌ ุงููุตู ูู ุงูุญุงูุธุฉ ูููุตูู ุงูุฃุณุทุฑ ุชููุงุฆูุงู ุฅูู ุฃููุงุน ุณููุงุฑูู.

### ูููู ุงูููู:

```
โโโ ุงูุงุณุชูุฑุงุฏุงุช (1-7)
โโโ ุงูุฃุฏูุงุช ุงููุณุงุนุฏุฉ (9-25)
โโโ ููุงุนุฏ ุงูุชุจุงุนุฏ (27-93)
โโโ ุจูุงุก HTML (95-112)
โโโ ุชูุธูู ุงููุตูุต (114-131)
โโโ ูุดู ุงูุจุณููุฉ (133-152)
โโโ ููุทู ุนููุงู ุงููุดูุฏ (154-203)
โโโ ููุทู ุงูุญุฑูุฉ (205-265)
โโโ ููุทู ุงูุดุฎุตูุฉ (267-378)
โโโ ูููุฐุฌ ุงูุณูุงู (380-479)
โโโ ุฎุท ุงูุชุตููู ุงูุฑุฆูุณู (481-620)
โโโ ุงูุชุตููู ุงููุนุฒุฒ ุจุงูุฐุงูุฑุฉ (622-707)
โโโ ูุนุงูุฌ ุงููุตู (709-885)
```

### ุดุฑุญ ุณุทุฑ ุจุณุทุฑ:

#### ุงูุฃุฏูุงุช ุงููุณุงุนุฏุฉ (15-25):

| ุงูุณุทุฑ | ุงูุดููุฑุฉ | ุงููุตู |
|-------|---------|-------|
| 15-25 | `const cssObjectToString = (styles) => { ... }` | ุชุญููู ูุงุฆู CSS ุฅูู ูุต |
| 16-17 | `return Object.entries(styles)` | ุชุญููู ุงููุงุฆู ุฅูู ูุตูููุฉ ูู ุงูุฃุฒูุงุฌ [key, value] |
| 18-21 | `.map(([key, value]) => { ... })` | ุชุญููู ุฃุณูุงุก ุงูุฎุตุงุฆุต ูู camelCase ุฅูู kebab-case |
| 24 | `.join('; ')` | ุฏูุฌๆๆ ุงูุฎุตุงุฆุต ุจููุทุฉ ููููุทุฉ |

#### ููุงุนุฏ ุงูุชุจุงุนุฏ (42-93):

| ุงูุณุทุฑ | ุงูุดููุฑุฉ | ุงููุตู |
|-------|---------|-------|
| 42 | `const getSpacingMarginTop = (previousFormat, currentFormat)` | ุฏุงูุฉ ุชุญุฏุฏ ุงููุณุงูุฉ ุงูุนูููุฉ ุจูู ุงูุนูุงุตุฑ |
| 46-48 | `if (previousFormat === 'basmala') return '0';` | ุจุนุฏ ุงูุจุณููุฉ ูุง ุชูุฌุฏ ูุณุงูุฉ |
| 50-54 | `if (previousFormat === 'character')` | ุจุนุฏ ุงุณู ุงูุดุฎุตูุฉ |
| 51-52 | `if (currentFormat === 'dialogue'...) return '0';` | ุงูุญูุงุฑ ูุชุจุน ูุจุงุดุฑุฉ ุจุฏูู ูุณุงูุฉ |
| 60-62 | `scene-header-2 โ scene-header-3` | ูุณุงูุฉ 14pt |
| 68-72 | `action โ action/character/transition` | ูุณุงูุฉ 14pt |
| 74-78 | `dialogue โ character/action/transition` | ูุณุงูุฉ 14pt |

#### ุจูุงุก HTML (95-112):

| ุงูุณุทุฑ | ุงูุดููุฑุฉ | ุงููุตู |
|-------|---------|-------|
| 95 | `const buildLineDivHTML = (...)` | ุฏุงูุฉ ูุจูุงุก ุนูุตุฑ div ููุณู |
| 101 | `const div = document.createElement('div');` | ุฅูุดุงุก ุนูุตุฑ div ุฌุฏูุฏ |
| 102 | `div.className = className;` | ุชุนููู ุงุณู ุงูููุงุณ |
| 104-107 | `const finalStyles = { ...styles }; if (marginTop)` | ุฏูุฌ ุงูุฃููุงุท ูุน ุงููุณุงูุฉ ุงูุนูููุฉ |
| 109 | `div.setAttribute('style', cssObjectToString(finalStyles));` | ุชุนููู ุงูุฃููุงุท ููุต |
| 110 | `div.textContent = text;` | ุชุนููู ุงููุต |
| 111 | `return div.outerHTML;` | ุฅุฑุฌุงุน HTML ุงููุงูู |

#### ุชูุธูู ุงููุตูุต (114-131):

| ุงูุณุทุฑ | ุงูุดููุฑุฉ | ุงููุตู |
|-------|---------|-------|
| 114-119 | `const stripLeadingBullets = (input)` | ุฅุฒุงูุฉ ุงูููุงุท ุงูุจูููุงุฑุฏ ูู ุจุฏุงูุฉ ุงููุต |
| 121-127 | `const normalizeLine = (input)` | ุชูุธูู ุดุงูู ูููุต (ุฅุฒุงูุฉ ุงูุชุดููู ูุงููุณุงูุงุช ุงูุฒุงุฆุฏุฉ) |
| 123 | `.replace(/[\u064B-\u065F\u0670]/g, '')` | ุฅุฒุงูุฉ ุนูุงูุงุช ุงูุชุดููู ุงูุนุฑุจู |
| 124 | `.replace(/[\u200f\u200e\ufeff\t]+/g, '')` | ุฅุฒุงูุฉ ุฃุญุฑู ุงูุชุญูู ุงููุฎููุฉ |
| 129-131 | `const hasSentencePunctuation = (line)` | ุงูุชุญูู ูู ูุฌูุฏ ุนูุงูุงุช ุชุฑููู |

#### ูุดู ุงูุจุณููุฉ (139-152):

| ุงูุณุทุฑ | ุงูุดููุฑุฉ | ุงููุตู |
|-------|---------|-------|
| 139 | `const isBasmala = (line): boolean` | ุฏุงูุฉ ูููุดู ุนู ุงูุจุณููุฉ |
| 140-144 | `const cleaned = ... const normalized = ...` | ุชูุธูู ูุชุทุจูุน ุงููุต |
| 146 | `const compact = normalized.replace(/[^\u0600-\u06FF\s]/g, '')` | ุงูุงุญุชูุงุธ ุจุงูุญุฑูู ุงูุนุฑุจูุฉ ููุท |
| 147-149 | `const hasBasm / hasAllah / hasRahman` | ุงูุจุญุซ ุนู ูููุงุช ุงูุจุณููุฉ |
| 151 | `return hasBasm && hasAllah && hasRahman` | ูุฌุจ ูุฌูุฏ ุงููููุงุช ุงูุซูุงุซ |

#### ุนููุงู ุงููุดูุฏ (160-203):

| ุงูุณุทุฑ | ุงูุดููุฑุฉ | ุงููุตู |
|-------|---------|-------|
| 160 | `const SCENE_NUMBER_RE = /(?:ูุดูุฏ|scene)\s*([0-9ู-ูฉ]+)/i;` | ููุท ุฑูู ุงููุดูุฏ |
| 161 | `const SCENE_NUMBER_EXACT_RE = ...` | ููุท ูุทุงุจู ุชุงู ูู ุงูุจุฏุงูุฉ |
| 163 | `const isSceneHeader1 = (line)` | ูุดู ุฑูู ุงููุดูุฏ |
| 168-169 | `const TIME_RE / LOCATION_RE` | ุฃููุงุท ุงูููุช ูุงููููุน |
| 171 | `const isSceneHeader2 = (line)` | ูุดู ูุตู ุงููุดูุฏ (ูุฌุจ ูุญุชูู ููุช ููููุน) |
| 181 | `const isCompleteSceneHeader = (line)` | ูุดู ุนููุงู ุงููุดูุฏ ุงููุงูู |
| 186 | `const splitSceneHeader = (line)` | ูุตู ุฑูู ุงููุดูุฏ ุนู ุงููุตู |
| 199 | `const isTransition = (line)` | ูุดู ูููุงุช ุงูุงูุชูุงู |

#### ููุทู ุงูุญุฑูุฉ (211-265):

| ุงูุณุทุฑ | ุงูุดููุฑุฉ | ุงููุตู |
|-------|---------|-------|
| 211-215 | `const ACTION_VERB_LIST = 'ูุฏุฎู\|ูุฎุฑุฌ\|...'` | ูุงุฆูุฉ ุฃูุนุงู ุงูุญุฑูุฉ (ุฃูุซุฑ ูู 200 ูุนู) |
| 217-222 | `const ACTION_VERB_SET = new Set(...)` | ุชุญููู ุงููุงุฆูุฉ ุฅูู Set ููุจุญุซ ุงูุณุฑูุน |
| 224 | `const isActionVerbStart = (line)` | ูุดู ูุง ุฅุฐุง ูุงู ุงูุณุทุฑ ูุจุฏุฃ ุจูุนู ุญุฑูุฉ |
| 233-239 | `const leadingParticles = ['ู', 'ู', 'ู']` | ุงูุชุญูู ูู ุฃุฏุงุฉ ุงูุจุฏุงูุฉ (ููุนู) |
| 244 | `const matchesActionStartPattern = (line)` | ูุทุงุจูุฉ ุฃููุงุท ุจุฏุงูุฉ ุงูุญุฑูุฉ |
| 256 | `const isLikelyAction = (line)` | ูุดู ุงุญุชูุงููุฉ ุฃู ุชููู ุงูุญุฑูุฉ |

#### ููุทู ุงูุดุฎุตูุฉ (273-378):

| ุงูุณุทุฑ | ุงูุดููุฑุฉ | ุงููุตู |
|-------|---------|-------|
| 273-274 | `const CHARACTER_RE = /^\s*(?:ุตูุช\s+)?[\u0600-\u06FF].../` | ููุท ุงุณู ุงูุดุฎุตูุฉ |
| 276-278 | `const isParenthetical = (line)` | ูุดู ุงูุชุนููู ุจูู ููุณูู |
| 280 | `const parseInlineCharacterDialogue = (line)` | ุงุณุชุฎุฑุงุฌ ุงุณู ุงูุดุฎุตูุฉ ูุงูุญูุงุฑ ูู ุณุทุฑ ูุงุญุฏ |
| 284 | `const inlineMatch = trimmed.match(/^([^:๏ผ]{1,60}?)\s*[:๏ผ]\s*(.+)$/)` | ูุทุงุจูุฉ ุงูููุท "ุงุณู: ุญูุงุฑ" |
| 295 | `const isCharacterLine = (line, context)` | ูุดู ุณุทุฑ ุงูุดุฎุตูุฉ |
| 312 | `const wordCount = normalized.split(/\s+/).length` | ุญุณุงุจ ุนุฏุฏ ุงููููุงุช |
| 332-355 | `const stopWords = new Set(['ูู', 'ุนูู', ...])` | ูููุงุช ุงูุชููู ุงูุนุฑุจูุฉ |
| 380 | `const isLikelyDialogue = (line, previousFormat)` | ูุดู ุงุญุชูุงููุฉ ุงูุญูุงุฑ |

#### ูููุฐุฌ ุงูุณูุงู (399-479):

| ุงูุณุทุฑ | ุงูุดููุฑุฉ | ุงููุตู |
|-------|---------|-------|
| 399 | `const buildContext = (lines, currentIndex, previousTypes)` | ุจูุงุก ุณูุงู ุงูุณุทุฑ |
| 404 | `const WINDOW_SIZE = 3` | ุญุฌู ูุงูุฐุฉ ุงูุณูุงู (3 ุฃุณุทุฑ ูุจู ูุจุนุฏ) |
| 407-410 | `const previousLines = []` | ุฌูุน ุงูุฃุณุทุฑ ุงูุณุงุจูุฉ |
| 412-419 | `const nextLines = []` | ุฌูุน ุงูุฃุณุทุฑ ุงูุชุงููุฉ |
| 423-434 | `const stats = { ... }` | ุญุณุงุจ ุฅุญุตุงุฆูุงุช ุงูุณุทุฑ |
| 439-443 | `const isInDialogueBlock` | ุงูุชุญูู ูู ูุฌูุฏูุง ูู ูุชูุฉ ุญูุงุฑ |
| 450-456 | `let lastSceneDistance = -1` | ุญุณุงุจ ุงููุณุงูุฉ since ุขุฎุฑ ูุดูุฏ |
| 458-464 | `let lastCharacterDistance = -1` | ุญุณุงุจ ุงููุณุงูุฉ since ุขุฎุฑ ุดุฎุตูุฉ |

#### ุงูุชุตููู (487-620):

| ุงูุณุทุฑ | ุงูุดููุฑุฉ | ุงููุตู |
|-------|---------|-------|
| 487 | `const isSceneHeader3 = (line, ctx)` | ูุดู ุงูุฌุฒุก ุงูุซุงูุซ ูู ุนููุงู ุงููุดูุฏ |
| 505 | `const KNOWN_PLACES = /^(ูุณุฌุฏ\|ุจูุช\|...)/i` | ูุงุฆูุฉ ุงูุฃูุงูู ุงููุนุฑููุฉ |
| 523 | `const isLikelyCharacter = (line, ctx)` | ูุดู ุงุญุชูุงููุฉ ุงูุดุฎุตูุฉ |
| 540 | `const classifyWithContext = (line, ctx)` | ุงูุชุตููู ุจุงุณุชุฎุฏุงู ุงูุณูุงู |
| 544-549 | `if (isBasmala / isCompleteSceneHeader / ...)` | ุณูุณูุฉ ูุญูุตุงุช ููุชุตููู |
| 567-585 | `if (ctx.pattern.isInDialogueBlock)` | ููุทู ุฎุงุต ุฏุงุฎู ูุชูุฉ ุงูุญูุงุฑ |

#### ุงูุชุตููู ุงููุนุฒุฒ (628-707):

| ุงูุณุทุฑ | ุงูุดููุฑุฉ | ุงููุตู |
|-------|---------|-------|
| 628 | `const classifyWithContextAndMemory = async (...)` | ุงูุชุตููู ูุน ุงุณุชุฎุฏุงู ุงูุฐุงูุฑุฉ |
| 639 | `const memory = await memoryManager.loadContext(sessionId)` | ุชุญููู ุฐุงูุฑุฉ ุงูุฌูุณุฉ |
| 647 | `const knownCharacter = memory.data.commonCharacters.find(...)` | ุงูุจุญุซ ุนู ุดุฎุตูุงุช ูุนุฑููุฉ |
| 663 | `const recentPattern = memory.data.lastClassifications.slice(0, 3)` | ุฃุฎุฐ ุขุฎุฑ 3 ุชุตูููุงุช |
| 668-684 | `if (recentPattern.startsWith('character-dialogue'))` | ุงุณุชุฎุฏุงู ุงูุฃููุงุท ููุชุตููู ุงูุฐูู |

#### ูุนุงูุฌ ุงููุตู (715-885):

| ุงูุณุทุฑ | ุงูุดููุฑุฉ | ุงููุตู |
|-------|---------|-------|
| 715 | `export const handlePaste = async (...)` | ุงูุฏุงูุฉ ุงูุฑุฆูุณูุฉ ููุนุงูุฌุฉ ุงููุตู |
| 727 | `e.preventDefault();` | ููุน ุงูุณููู ุงูุงูุชุฑุงุถู ููุตู |
| 731 | `const textData = e.clipboardData.getData('text/plain');` | ุงุณุชุฎุฑุงุฌ ุงููุต ูู ุงูุญุงูุธุฉ |
| 737 | `const selection = window.getSelection();` | ุงูุญุตูู ุนูู ุชุญุฏูุฏ ุงููุต |
| 743 | `const lines = textData.split('\n')` | ุชูุณูู ุงููุต ุฅูู ุฃุณุทุฑ |
| 759-859 | `for (let i = 0; i < lines.length; i++)` | ุงูุชูุฑุงุฑ ุนูู ูู ุณุทุฑ |
| 763 | `const strippedLine = stripLeadingBullets(trimmedLine);` | ุฅุฒุงูุฉ ุงูููุงุท |
| 764 | `const ctx = buildContext(lines, i, classifiedTypes)` | ุจูุงุก ุณูุงู ุงูุณุทุฑ |
| 769 | `const inlineParsed = parseInlineCharacterDialogue(...)` | ูุญุงููุฉ ุงุณุชุฎุฑุงุฌ ุญูุงุฑ ูุฏูุฌ |
| 796 | `const classification = await classifyWithContextAndMemory(...)` | ุชุตููู ุงูุณุทุฑ |
| 803-836 | `if (classification === 'scene-header-top-line')` | ูุนุงูุฌุฉ ุฎุงุตุฉ ูุนููุงู ุงููุดูุฏ |
| 843 | `if (formatClass === 'character') cleanLine = cleanLine + ':'` | ุฅุถุงูุฉ ููุทุชูู ูุงุณู ุงูุดุฎุตูุฉ |
| 861 | `const range = selection.getRangeAt(0)` | ุงูุญุตูู ุนูู ูุทุงู ุงูุฅุฏุฑุงุฌ |
| 862 | `range.deleteContents()` | ุญุฐู ุงููุญุชูู ุงููุญุฏุฏ |
| 864 | `const tempContainer = document.createElement('div')` | ุฅูุดุงุก ุญุงููุฉ ูุคูุชุฉ |
| 867 | `const fragment = document.createDocumentFragment()` | ุฅูุดุงุก ุฌุฒุก ูุณุชูุฏ |
| 872 | `range.insertNode(fragment)` | ุฅุฏุฑุงุฌ HTML ุงูููุณู |
| 882 | `updateContentFn()` | ุชุญุฏูุซ ูุญุชูู ุงููุญุฑุฑ |

---

## ๐ ููุฎุต ุงูุนูุงูุงุช ุจูู ุงููููุงุช

```
index.ts (ุชุตุฏูุฑ ูุฑูุฒู)
    โโ cn.ts (ุฏูุฌ ุงูููุงุณุงุช)
    โโ logger.ts (ุงูุชุณุฌูู)
    โโ editor-styles.ts (ุงูุฃููุงุท)
    โโ context-memory-manager.ts (ุฅุฏุงุฑุฉ ุงูุฐุงูุฑุฉ)
    โ   โโ ูุณุชุฎุฏู โ logger.ts
    โโ paste-classifier.ts (ูุนุงูุฌ ุงููุตู)
        โโ ูุณุชุฎุฏู โ logger.ts
        โโ ูุณุชุฎุฏู โ context-memory-manager.ts
        โโ ูุณุชุฎุฏู โ editor-styles.ts
```

---

## ๐ง ุงูุชุฏููุงุช ุงูุฑุฆูุณูุฉ

### ุชุฏูู ูุนุงูุฌุฉ ุงููุตู:
```
1. ุงููุณุชุฎุฏู ููุตู ูุต
   โ
2. handlePaste() ูู paste-classifier.ts
   โ
3. ุชูุณูู ุงููุต ุฅูู ุฃุณุทุฑ
   โ
4. ููู ุณุทุฑ:
   - ุจูุงุก ุงูุณูุงู (buildContext)
   - ุงูุชุตููู (classifyWithContextAndMemory)
   - ุงูุญุตูู ุนูู ุงูุฃููุงุท (getFormatStyles)
   - ุจูุงุก HTML (buildLineDivHTML)
   โ
5. ุฅุฏุฑุงุฌ HTML ูู ุงููุญุฑุฑ
```

### ุชุฏูู ุชุญุฏูุซ ุงูุฐุงูุฑุฉ:
```
1. ุงูุชุตููู ููุชุดู ุดุฎุตูุฉ
   โ
2. updateMemory() ูู context-memory-manager.ts
   โ
3. ุชุญููู ุงูุฐุงูุฑุฉ ุงูุญุงููุฉ
   โ
4. ุฅุถุงูุฉ ุงูุดุฎุตูุฉ ูู commonCharacters
   โ
5. ุฒูุงุฏุฉ ุนุฏุงุฏ ุงูุญูุงุฑุงุช
   โ
6. ุญูุธ ุงูุฐุงูุฑุฉ ุงููุญุฏุซุฉ
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุฐุงูุฑุฉ ูู ุงูุฐุงูุฑุฉ RAM ููุท** - ContextMemoryManager ุญุงููุงู ูุณุชุฎุฏู Map ูููุณ localStorage
2. **ุฏุนู ุงููุบุฉ ุงูุนุฑุจูุฉ** - ุฌููุน ุงูุฃููุงุท ููุตููุฉ ูููุต ุงูุนุฑุจู (RTLุ ุฎุทูุท ุนุฑุจูุฉ)
3. **ุฃููุงุน ุงูุชูุณูู** - ูุฏุนู 10 ุฃููุงุน ูุฎุชููุฉ ูู ุนูุงุตุฑ ุงูุณููุงุฑูู
4. **ุงูุชุจุงุนุฏ ุงูุฐูู** - ููุงุนุฏ ูุนูุฏุฉ ูุชุญุฏูุฏ ุงููุณุงูุงุช ุจูู ุงูุนูุงุตุฑ

---

ุชู ุฅูุดุงุก ูุฐุง ุงูุชูุซูู ูู: `2025-01-20`
