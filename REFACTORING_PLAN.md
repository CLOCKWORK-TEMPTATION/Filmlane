# ุฎุทุฉ ุฅุนุงุฏุฉ ููููุฉ ุงูููุฏ (Code Refactoring Plan)

## 1๏ธโฃ ุงูุฃููุงุฏ ุบูุฑ ุงููุณุชุฎุฏูุฉ ูุงูููุชุฉ (Dead Code) ๐งน

### ูู ููู `ScreenplayEditor.tsx`:

#### ุงููุดููุฉ ุงูุฃููู: ุญุงูุฉ `isProcessingAI`
- **ุงููุตู**: ุงููุชุบูุฑ `isProcessingAI` ูุงูุฏุงูุฉ `setIsProcessingAI` ููุฌูุฏุงู ูููููุง ุบูุฑ ูุณุชุฎุฏููู ูุนููุงู
- **ุงูุชูุงุตูู**: ูุชู ุงุณุชุฏุนุงุคููุง ูู `handleGenerateIdeas` ู `handleAutoFormat` ููู ูุง ููุฌุฏ ูุคุดุฑ loading ูุธูุฑ ูููุณุชุฎุฏู ูู ุงูู UI ุจูุงุกู ุนููููุง
- **ุงูุญู ุงูููุชุฑุญ**: 
  - ุฅูุง ุฅุถุงูุฉ ูุคุดุฑ ุชุญููู (Spinner) ูู ุงููุงุฌูุฉ ูุนุชูุฏ ุนูู ูุฐู ุงูุญุงูุฉ
  - ุฃู ุญุฐู ุงูุญุงูุฉ ุชูุงูุงู ุฅุฐุง ูู ุชูู ูุทููุจุฉ ุญุงููุงู

#### ุงููุดููุฉ ุงูุซุงููุฉ: ุงูุฏูุงู ุงูููููุฉ (Mock Functions)
- **ุงูุฏูุงู ุงููุชุฃุซุฑุฉ**: 
  - `handleHistory`
  - `handleSave`
  - `handleDownload`
- **ุงููุตู**: ูุฐู ุงูุฏูุงู ูุฌุฑุฏ "Mock functions" ุชุนุฑุถ ุฑุณุงุฆู Toast ููุท
- **ุงูุญู ุงูููุชุฑุญ**: 
  - ุชูุถูุญ ุฃููุง ุฏูุงู ูุคูุชุฉ ุจุฅุถุงูุฉ ุชุนููู `// TODO: Implement actual logic`
  - ุฃู ุงูุจุฏุก ูู ุชุทุจูู ุงูููุทู ุงูุญูููู ููุง

---
ููุฐ 

## 2๏ธโฃ ุงูุชูุฑุงุฑ ูุณูุก ุงูุชูุฒูุน (Duplication & Separation of Concerns) โ๏ธ

### ุงููุดููุฉ ุงูุฃููู: ููุทู ููุงุนุฏ ุงูุณููุงุฑูู (Business Logic Leakage)

#### ุงููุตู:
ูู `EditorArea.tsx`, ุชูุฌุฏ ุฏุงูุชุงู ููุทููุชุงู ุจุญุชุชุงู:
- `getNextFormatOnEnter` (ูู ุฃุณูู ุงูููู)
- `getNextFormatOnTab`

ูุฐู ุฏูุงู "Business Rules" ุชุญุฏุฏ ููุงุนุฏ ุงููุชุงุจุฉ ุงูููุงุณูุฉ ููุณููุงุฑูู. ูุฌูุฏูุง ุฏุงุฎู ููู ุงูู React Component ููุณ ูุซุงููุงู.

#### ุงูุญู ุงูููุชุฑุญ:
```
โ ุฅูุดุงุก ููู ุฌุฏูุฏ: src/utils/screenplay-rules.ts
โ ููู ุงูุฏูุงู ุงูููุทููุฉ ุฅููู
โ ุงุณุชูุฑุงุฏูุง ูู EditorArea.tsx
```

#### ุงูููุงุฆุฏ:
- โจ ุฌุนู `EditorArea` ุฃุตุบุฑ ูุฃุณูู ูููุฑุงุกุฉ
- โจ ุฅููุงููุฉ ุงุฎุชุจุงุฑ (Unit Test) ููุงุนุฏ ุงูุณููุงุฑูู ุจุดูู ูููุตู
- โจ ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ุงูููุงุนุฏ ูู ุฃูุงูู ุฃุฎุฑู ุฅุฐุง ูุฒู ุงูุฃูุฑ

---

### ุงููุดููุฉ ุงูุซุงููุฉ: ูุนุงูุฌุฉ DOM ุงููุจุงุดุฑุฉ (Direct DOM Manipulation)

#### ุงููุตู:
ุงูุฏูุงู `handleGenerateIdeas` ู `handleAutoFormat` ูู `ScreenplayEditor.tsx` ุชููู ุจุญูู HTML ูุจุงุดุฑุฉ ูู:
```typescript
editorRef.current.innerHTML = ...
```

ูุฐุง ุงูุฃุณููุจ "Imperative" ูุฏ ูุณุจุจ ูุดุงูู ูู:
- โ ุชุชุจุน ุญุงูุฉ ุงูู Undo/Redo
- โ ุญุงูุฉ React
- โ ุตุนูุจุฉ ุงูุตูุงูุฉ

#### ุงูุญู ุงูุฃูุถู:
ุฅูุดุงุก ุฏุงูุฉ ุฏุงุฎู `EditorArea` ุจุงุณุชุฎุฏุงู `useImperativeHandle`:

```typescript
// ูู EditorArea.tsx
useImperativeHandle(ref, () => ({
  insertContent: (html: string) => {
    // ุฅุถุงูุฉ ุงููุญุชูู
    // ุชูุธูู DOM
    // ุชุญุฏูุซ ุงูุชุงุฑูุฎ (History)
    // ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช
  }
}));
```

ุซู ูู `ScreenplayEditor.tsx`:
```typescript
editorRef.current?.insertContent(generatedHTML);
```

#### ุงูููุงุฆุฏ:
- โ ุงูุงุจู (EditorArea) ูุชุญูู ูู DOM ุงูุฎุงุต ุจู
- โ ุงูุฃุจ (ScreenplayEditor) ูุง ูุนุจุซ ูู ุชูุงุตูู DOM
- โ ุณูููุฉ ุชุชุจุน ุงูุชุบููุฑุงุช ูุงูู History
- โ ููุฏ ุฃูุธู ูุฃูุซุฑ ูุงุจููุฉ ููุตูุงูุฉ

---

## 3๏ธโฃ ุงููููุงุช ูุงูุชูุธูู (File Organization) ๐

### ุงููุถุน ุงูุญุงูู:

| ุงููุฌูุฏ/ุงูููู | ุงูุญุงูุฉ | ุงูููุงุญุธุงุช |
|--------------|--------|-----------|
| `ui/` | โ ููุชุงุฒ | ูุญุชูู ุนูู ููููุงุช Shadcn UI (button.tsx, dialog.tsx, ุฅูุฎ) |
| `ai/` | โ ููุธู ุฌูุฏุงู | ูุญุชูู ุนูู flows ู genkit.ts |
| `components/index.ts` | โ ูุญุฏุซ | ูุตุฏุฑ ูู ุงูููููุงุช |
| `utils/index.ts` | โ ูุนูู | ูุตุฏุฑ ูู ุงูุฃุฏูุงุช |
| `constants/index.ts` | โ ููุชุงุฒ | ููู barrel ููุธู |

### ุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ:
- โ ุฅุถุงูุฉ `src/utils/screenplay-rules.ts` (ุฌุฏูุฏ)
- โ ุชุญุฏูุซ `src/utils/index.ts` ูุชุตุฏูุฑ ุงูููุงุนุฏ ุงูุฌุฏูุฏุฉ

---

## 4๏ธโฃ ุงูุฎุทุฉ ุงูุชูููุฐูุฉ ุงูููุชุฑุญุฉ ๐๏ธ

ูููุตูู ุฅูู ููุฏ ูุซุงูู ("Clean Code")ุ ูุชุจุน ุงูุฎุทูุงุช ุงูุชุงููุฉ ุจุงูุชุฑุชูุจ:

### ุงูุฎุทูุฉ 1: ุชูุธูู `EditorArea.tsx` ๐งน
```
โ ุญุฐู ุฏุงูุฉ updateStats ุงููุฏููุฉ (ุงูุณุทุฑ 17-23)
โ ุงูุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุงุณุชุฏุนุงุกุงุช ููุง
```

### ุงูุฎุทูุฉ 2: ุฅูุดุงุก `src/utils/screenplay-rules.ts` ๐
```
โ ุฅูุดุงุก ุงูููู ุงูุฌุฏูุฏ
โ ููู ุฏุงูุฉ getNextFormatOnEnter
โ ููู ุฏุงูุฉ getNextFormatOnTab
โ ุฅุถุงูุฉ ุงูุชูุซูู ูุงูุชุนูููุงุช
โ ุชุตุฏูุฑ ุงูุฏูุงู
```

### ุงูุฎุทูุฉ 3: ุชุญุฏูุซ `EditorArea.tsx` ๐
```
โ ุงุณุชูุฑุงุฏ ุงูุฏูุงู ูู screenplay-rules.ts
โ ุญุฐู ุชุนุฑููุงุช ุงูุฏูุงู ุงููุฏููุฉ
โ ุฅุถุงูุฉ useImperativeHandle ูุน ุฏุงูุฉ insertContent
โ ุงุฎุชุจุงุฑ ุงููุธุงุฆู
```

### ุงูุฎุทูุฉ 4: ุชูุธูู `ScreenplayEditor.tsx` ๐จ
```
โ ุฅุถุงูุฉ ูุคุดุฑ ุชุญููู (Spinner) ูุนุชูุฏ ุนูู isProcessingAI
   ุฃู ุญุฐู ุงูุญุงูุฉ ุฅุฐุง ูู ุชูู ูุทููุจุฉ
โ ุฅุถุงูุฉ ุชุนูููุงุช TODO ููุฏูุงู ุงูููููุฉ
โ ุชุญุฏูุซ handleGenerateIdeas ูุงุณุชุฎุฏุงู insertContent
โ ุชุญุฏูุซ handleAutoFormat ูุงุณุชุฎุฏุงู insertContent
```

### ุงูุฎุทูุฉ 5: ุชุญุฏูุซ ูููุงุช ุงูู Barrel ๐ฆ
```
โ ุชุญุฏูุซ src/utils/index.ts ูุชุตุฏูุฑ screenplay-rules
โ ุงูุชุฃูุฏ ูู ุนูู ุฌููุน ุงูุงุณุชูุฑุงุฏุงุช
```

---

## ๐ ุงููุชุงุฆุฌ ุงููุชููุนุฉ

### ูุจู ุงูุชูุธูู:
- โ ููุฏ ููุช ุบูุฑ ูุณุชุฎุฏู
- โ ููุทู ุงูุฃุนูุงู ูุฎุชูุท ูุน UI
- โ ูุนุงูุฌุฉ DOM ูุจุงุดุฑุฉ
- โ ุตุนูุจุฉ ุงูุงุฎุชุจุงุฑ
- โ ูููุงุช ูุจูุฑุฉ ููุนูุฏุฉ

### ุจุนุฏ ุงูุชูุธูู:
- โ ููุฏ ูุธูู ุจุฏูู ุฃุฌุฒุงุก ููุชุฉ
- โ ูุตู ูุงุถุญ ุจูู ุงูููุทู ูุงูุนุฑุถ
- โ ูุนุงูุฌุฉ DOM ููุธูุฉ ุนุจุฑ API ูุงุถุญ
- โ ุณูููุฉ ูุชุงุจุฉ Unit Tests
- โ ูููุงุช ุฃุตุบุฑ ูุฃุณูู ูููุฑุงุกุฉ
- โ ูุงุจููุฉ ุตูุงูุฉ ุฃุนูู

---

## ๐ ุงูุจุฏุก ุจุงูุชูููุฐ

**ุงูุณุคุงู**: ูู ุชุฑูุฏ ุฃู ุฃุจุฏุฃ ุจู "ุชูุธูู EditorArea.tsx" ูููู ููุงุนุฏ ุงูุณููุงุฑูู ูููู ูููุตูุ

**ุงููุงุฆุฏุฉ**: ูุฐุง ุณูููู ุญุฌู ุงูููู ุจุดูู ูุจูุฑ ููุฌุนู ุงูููุฏ ุฃูุซุฑ ุงุญุชุฑุงููุฉ.

---

## ๐ ููุงุญุธุงุช ุฅุถุงููุฉ

- ูููุถู ุนูู commit ูู Git ูุจู ุงูุจุฏุก ุจุงูุชูุธูู
- ุงุฎุชุจุงุฑ ูู ุฎุทูุฉ ุนูู ุญุฏุฉ ูุจู ุงูุงูุชูุงู ููุชุงููุฉ
- ุงูุงุญุชูุงุธ ุจูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ุงููููุงุช ุงูุฃุตููุฉ
- ูุฑุงุฌุนุฉ ุงูููุฏ ุจุนุฏ ูู ุชุนุฏูู ููุชุฃูุฏ ูู ุนููู ุจุดูู ุตุญูุญ

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก**: $(date)
**ุงูุญุงูุฉ**: ๐ ุฌุงูุฒ ููุชูููุฐ
**ุงูุฃููููุฉ**: ๐ฅ ุนุงููุฉ
