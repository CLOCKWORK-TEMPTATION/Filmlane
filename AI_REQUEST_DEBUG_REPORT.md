# تقرير تفصيلي: آلية عمل الذكاء الاصطناعي (AI Workflow Report)

## 1. لماذا "البرومبت" (Prompt) باللغة الإنجليزية؟

يتم استخدام اللغة الإنجليزية في التعليمات (System Instructions) للأسباب التالية:

- **كفاءة النماذج (Model Efficiency):** معظم النماذج اللغوية الكبيرة (LLMs) مثل AceGPT أو Llama مدربة بشكل مكثف على تعليمات إنجليزية. هي تفهم النص العربي جيداً، لكنها _تتبع التعليمات_ بدقة أكبر عندما تُصان بالإنجليزية.
- **توفير التوكنز (Token Savings):** الكلمات الإنجليزية تستهلك عدد توكنز (Tokens) أقل مقارنة بالعربية في التعليمات التقنية، مما يترك مساحة أكبر للنص العربي المراد معالجته (وهو الأهم).
- **الفصل الذهني (Context Separation):** يساعد فصل لغة التعليمات (إنجليزي) عن لغة المحتوى (عربي) النموذج على التمييز بوضوح بين "ما يجب عليه فعله" وبين "النص الذي يعالجه".

## 2. سير العمل الحالي (Workflow) لتحديد الجمل

عندما تقوم بعمل "لصق" (Paste) للنص، تمر البيانات بالمراحل التالية:

1.  **الاستلام (Capture):** يتم استلام النص المنسوخ ككتلة واحدة.
2.  **التصنيف المبدئي (Initial Classification):** يحاول الكود (بدون ذكاء اصطناعي) تخمين نوع السطر (حوار، مشهد، وصف) بناءً على القواعد البسيطة.
3.  **تجهيز الحمولة (Payload Preparation):**
    - يتم تحويل الأسطر إلى مصفوفة JSON.
    - **الفلترة والقص (Truncation Strategy):**
      - نأخذ أول 40 سطر كحد أقصى.
      - نقوم بحساب حجم النص بصيغة JSON.
      - إذا تجاوز الحجم 1800 حرف، نقوم بحذف الأسطر الأخيرة تدريجياً حتى يصبح الحجم مناسباً.
4.  **الإرسال (Dispatch):** يتم دمج المصفوفة النهائية في "القالب" (Prompt Template) وإرسالها للنموذج.

## 3. نسخة طبق الأصل مما يتم إرساله (Simulation)

هذا ما يراه النموذج بالضبط (مع مثال لنص عربي):

```text
You are an expert Arabic screenplay editor helper.
Your task is to review a block of pasted text.
Return JSON with "patches" for misclassified lines.

Rules:
1. "op": "relabel" or "split_inline".
2. Only correct ERRORS.
3. Output strictly valid JSON.

Input:
[
  {
    "id": "line_1",
    "text": "ليلي",
    "type": "character"
  },
  {
    "id": "line_2",
    "text": "أنا مش عارفة أعمل إيه في الموضوع ده.",
    "type": "dialogue"
  }
]

Output (JSON):
```
