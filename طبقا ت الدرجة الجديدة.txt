لو الحالة مافيهاش ترقيم ولا أدوات نداء

وقتها الدالة الحالية لن تقسّم السطر وسترجّع null، وهذا مقصود لأنها “محافظة” لتجنب خطأ أخطر: أن أي جملة أكشن تبدأ باسم شخص تتحول بالغلط إلى “شخصية + حوار”.

لماذا هذا مهم؟
في العربية كثير من الأكشن يبدأ باسم:
- جهيمان يترك عبد العزيز...
- عبد العزيز يتلفت حوله...

ولو سمحنا بالتقسيم بدون أي إشارة حوار، سنكسر تصنيفات أكشن كثيرة “منضبطة الآن” كما قلت.

ما الحل إذا كان فعلاً (شخصية + حوار) بدون أي إشارة؟
عندك 3 خيارات آمنة، مرتبة من الأكثر أمانًا للأكثر “ذكاءً لكن أخطر”:

1) الأكثر أمانًا (موصى به)
- تكتبها بصيغة السيناريو القياسية: اسم: ثم سطر الحوار.
هذا يضمن 100% تقسيم صحيح بدون تعقيد.

2) حل ذكي وآمن نسبيًا (أقترحه كتحسين لاحق)
نضيف “طبقة ثانية” للتقسيم بدون ترقيم/نداء لكن بشرط قوي جدًا:
- لا نسمح به إلا إذا كان characterName معروفًا مسبقًا (من ContextMemoryManager / commonCharacters) أو ظهر قبلها في نفس النص بصيغة اسم:.

بهذا نقلل جدًا احتمال قصّ الأكشن بالغلط.

3) حل متساهل (غير مفضل لأنه قد يسبب تعارض)
نوسع قائمة strongDialogueStartWords لتشمل كلمات كثيرة (مثل: نعم/لا/إن/لكن…)
هذا سيزيد التقسيم لكنه سيرفع false positives على الأكشن.

الخلاصة
- بدون ترقيم أو نداء: لن تُقسم الآن لحماية تصنيف الأكشن.
- لو تريد دعمها: أفضل طريقة هي الاعتماد على “معرفة الاسم كشخصية” عبر الذاكرة/السياق بدل التوسع العشوائي في الكلمات.

إذا تحب، قل لي: هل تريد أن نطبق الخيار (2) الآن؟ (سأعدله بشكل محافظ ثم أشغّل pnpm validate).

أسئلة عن طول جملة الأكشن/الحوار:

1) ماذا يحدث لو جملة الأكشن طويلة جدًا؟
- غالبًا ستُصنّف أكشن، لأن عندنا عقوبة إضافية في getDialogueProbability عندما تطابق الجملة نمط بداية الأكشن (matchesActionStartPattern) وهذا يخفض درجة الحوار.
- بالإضافة إلى ذلك: في classifyWithContext يوجد شرط: إذا السطر طويل وفيه ترقيم (ctx.stats.isLong && ctx.stats.hasPunctuation) فإنه يُرجّح الأكشن مباشرة.

2) ماذا يحدث لو جملة الحوار طويلة جدًا؟
- إذا كانت الجملة داخل كتلة حوار صحيحة (بعد character/parenthetical)، فغالبًا ستظل Dialogue بسبب قواعد كتلة الحوار في classifyWithContext.
- أما لو كانت خارج كتلة الحوار: ميزة “الطول” في getDialogueProbability تعطي +1 فقط عندما يكون الطول أقل من 90؛ إذا كانت أطول بكثير قد لا تستفيد من هذه النقطة، وبالتالي ستحتاج لمؤشرات حوار قوية أخرى (مثل ؟ أو يا أو علامات اقتباس) حتى تتجاوز العتبة.

سؤال عكسي (العامية vs الفصحى):

ماذا لو كان الحوار مكتوبًا بالفصحى (أو خليط فصحى/عامية)؟
- مؤشر “العامية” هنا هو إشارة إضافية فقط لرفع احتمال الحوار عند وجود كلمات عامية واضحة.
- لا توجد أي عقوبة على الفصحى: الحوار بالفصحى سيظل يُلتقط من السياق (كتلة الحوار بعد اسم شخصية) أو من مؤشرات أخرى مثل (؟) أو (يا) أو علامات الاقتباس.
- لو كان الحوار بالفصحى وخارج كتلة الحوار وبدون أي مؤشرات ترقيم/نداء، فسيكون تمييزه أصعب بطبيعته وقد يُعامل كأكشن؛ والحل الأدق في هذه الحالة هو كتابة اسم الشخصية بنقطتين (NAME:) أو الاعتماد على “معرفة الاسم كشخصية” عبر الذاكرة/السياق.
